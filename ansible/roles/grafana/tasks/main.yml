- name: A침adir el repositorio de Prometheus
  ansible.builtin.shell: |
    helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
    helm repo update

- name: Instalar Grafana
  ansible.builtin.shell: |
    helm upgrade --install --create-namespace -n grafana \
      kube-prometheus-stack prometheus-community/kube-prometheus-stack

- name: Copiar el fichero grafana-ingress.yml
  ansible.builtin.copy:
    src: ./files/grafana-ingress.yml
    dest: /tmp/grafana-ingress.yml

- name: Crear el Ingress para Grafana
  ansible.builtin.command: kubectl apply -f /tmp/grafana-ingress.yml

- name: A침adir el repositorio de Grafana
  ansible.builtin.shell: |
    helm repo add grafana https://grafana.github.io/helm-charts
    helm repo update

- name: Copiar la configuraci칩n de Loki
  ansible.builtin.copy:
    src: ./files/loki.yml
    dest: /tmp/loki.yml

- name: Instalar Loki
  ansible.builtin.shell: |
    helm upgrade --install --create-namespace --namespace loki logging grafana/loki -f /tmp/loki.yml \
      --set loki.auth_enabled=false

- name: Copiar la configuraci칩n de Alloy
  ansible.builtin.copy:
    src: ./files/alloy.yml
    dest: /tmp/alloy.yml

- name: Instalar Loki
  ansible.builtin.shell: |
    helm upgrade --install --create-namespace --namespace alloy alloy grafana/alloy -f /tmp/alloy.yml
