- name: Clonar el repositorio
  git:
    repo: https://github.com/rook/rook.git
    version: v{{ rook_version }}
    dest: /tmp/rook
    clone: yes
    depth: 1
    update: yes
    force: yes

- name: Instalar Rook Ceph
  args:
    chdir: /tmp/rook/deploy/examples
  ansible.builtin.shell: |
    kubectl apply -f crds.yaml -f common.yaml -f operator.yaml
    kubectl apply -f cluster.yaml
    kubectl apply -f toolbox.yaml
    kubectl apply -f csi/rbd/storageclass.yaml
    kubectl apply -f filesystem.yaml
    kubectl apply -f csi/cephfs/storageclass.yaml
    kubectl apply -f object.yaml
    kubectl apply -f storageclass-bucket-delete.yaml

- name: Copiar el fichero dashboard-ingress.yml
  ansible.builtin.copy:
    src: ./files/dashboard-ingress.yml
    dest: /tmp/dashboard-ingress.yml

- name: Crear el Ingress para el Dashboard de rook
  ansible.builtin.command: kubectl apply -f /tmp/dashboard-ingress.yml
